name: Auto Assign Reviewers

on: [pull_request]

jobs:
  auto-assign-reviewers:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0  # 全ての履歴をフェッチ

      # - name: List commits different from main and get GitHub usernames
      #   id: list-commits
      #   run: |
      #     git fetch origin main
      #     echo "Commits different from main:"
      #     git log --pretty="%an <%ae>" origin/main..HEAD | sort | uniq
      #     echo "GitHub usernames for the commits:"
      #     usernames=()
      #     for email in $(git log --pretty="%ae" origin/main..HEAD | sort | uniq); do
      #       user=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
      #                     "https://api.github.com/search/users?q=$email+in:email" | jq -r '.items[0].login')
      #       if [ ! -z "$user" ]; then
      #         usernames+=($user)
      #       fi
      #     done
      #     echo "::set-output name=usernames::${usernames[*]}"

      - name: Auto Assign Reviewers
        uses: kentaro-m/auto-assign-action@v1.1.2
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"
          configuration-path: ".github/auto_assign.yml"
